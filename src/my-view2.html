<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/gost-elements/gost-thing.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-input/paper-input-error.html">
<link rel="import" href="../bower_components/paper-input/paper-input-container.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-toggle-button/paper-toggle-button.html">
<link rel="import" href="../bower_components/gost-elements/gost-creator.html">

<link rel="import" href="geo-location.html">
<link rel="import" href="mock-device-orientation.html">
<link rel="import" href="shared-styles.html">

<dom-module id="my-view2">
  <template>
    <style include="shared-styles">
      :host {
        display: block;

        padding: 10px;
      }
    </style>

    <gost-creator id='creator'></gost-creator>
    <geo-location id="geolocator" idle=[[!locationtoggle]]></geo-location>
    <device-orientation id="orientator" 
      api-supported={{orientationsupported}}
      sensors-available={{sensorsavailable}}
      orientation={{myorientation}}
      active=false
    ></device-orientation>


    <div class="card">
      <div class="circle">2</div>
      <h1>Create your thing</h1>
      OrientationApi: [[orientationsupported]] <br>
      Sensoravailable: [[sensorsavailable]]<br>
      MyOrientation: [[myorientation.absolute]]<br>
      
      <form is="iron-form" id="form" method="post" action="#">
        <paper-input label="Your name" required auto-validate error-message="required"></paper-input>
        <paper-input label="Device name" required auto-validate error-message="required"></paper-input>
        <paper-dropdown-menu label="Device type">
          <paper-listbox slot="dropdown-content" selected="1">
            <paper-item>Android phone</paper-item>
            <paper-item>iPhone</paper-item>
            <paper-item>Windows phone</paper-item>
            <paper-item>other</paper-item>
          </paper-listbox>
        </paper-dropdown-menu>
        <paper-toggle-button id="locationtoggle" toggles checked={{locationtoggle}}>Enable location</paper-toggle-button>
        <paper-button raised on-click="submit">Submit</paper-button>
      </form>
    </div>
  </template>

  <script>
    class MyView2 extends Polymer.Element {
      static get is() { return 'my-view2'; }
      static get properties() { 
        return {
          locationtoggle: {
            type:Boolean,
            value: false
          }
        }
      }
      ready(){
        super.ready();
        var form = this.$.form;
        form.addEventListener('iron-form-presubmit', function(event) {
          event.preventDefault();
          //TODO: add form checking
        });
        /*TODO
        var loc = document.querySelector('geo-location');
        loc.addEventListener('geo-response', function(e) {
          console.log('lat:' + this.latitude, 'lng:' + this.longitude);
        });
        */

      }
      submit(){
        var mything = {
            "description": "My phone",
            "name":"Phone",
            "properties": {
                "organisation": null,
                "owner": null
            }
        }
        var mylocation = {
            "description": "my backyard",
            "name": "my backyard",
            "encodingType": "application/vnd.geo+json",
            "location": {
                "type": "Point",
                "coordinates": [-117.123,
                54.123]
            }
        };


        this.$.creator.createThing(mything);
      }
    }

    window.customElements.define(MyView2.is, MyView2);
  </script>
</dom-module>
